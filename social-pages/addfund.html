<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://checkout.flutterwave.com/v3.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Funds</title>
    <style>
    .spinner {
      display: none;
      margin: 1.5rem auto 0 auto;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #FFD600;
      border-radius: 50%;
      width: 300px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .processing-text {
      display: none;
      color: #FFD600;
      font-weight: bold;
      text-align: center;
      margin-top: 1rem;
    }
        body { font-family: Arial, sans-serif; background: #f4f6fa; margin: 0; }
        .container { max-width: 400px; margin: 5rem auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 2rem; }
        .form-group { position: relative; margin-bottom: 2rem; }
        .form-group input { width: 300px; padding: 1.2rem 0.7rem 0.5rem 0.7rem; border-radius: 5px; border: 1px solid #ccc; background: none; font-size: 1rem; outline: none; }
        .form-group label { position: absolute; top: 1.2rem; left: 0.8rem; color: #888; font-size: 1rem; pointer-events: none; transition: 0.2s ease all; background: #fff; padding: 0 0.2rem; }
        .form-group input:focus + label,
        .form-group input:not(:placeholder-shown) + label { top: -0.7rem; left: 0.6rem; font-size: 0.85rem; color: #2d3e50; }
        .bouncy-border { animation: borderBounce 1.2s infinite alternate; box-shadow: 0 0 0 0 #2d3e50; }
        @keyframes borderBounce { 0% { box-shadow: 0 0 0 0 #2d3e50; } 50% { box-shadow: 0 0 8px 2px #2d3e50; } 100% { box-shadow: 0 0 0 0 #2d3e50; } }
        .deposit-btn { background: #2d3e50; color: #fff; border: none; padding: 0.8rem 2rem; border-radius: 5px; cursor: pointer; font-size: 1rem; }
        .status { text-align: center; color: #2d3e50; margin-top: 1rem; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="text-align:center;">Add Funds</h2>
    <form id="fundForm" onsubmit="event.preventDefault(); startDeposit();">
      <div class="form-group">
        <input type="email" id="email" name="email" placeholder=" " required class="bouncy-border">
        <label for="email">Enter Email</label>
      </div>
      <div class="form-group">
        <input type="number" id="amount" name="amount" min="1" placeholder=" " required class="bouncy-border">
        <label for="amount">Enter Amount</label>
      </div>
      <button type="submit" class="deposit-btn">Deposit</button>
    </form>
    <div class="spinner" id="spinner"></div>
    <div class="processing-text" id="processingText">Processing...</div>
    <div id="status" class="status"></div>
    </div>
    <script>
    function startDeposit() {
      const amount = parseFloat(document.getElementById('amount').value);
      const email = document.getElementById('email').value.trim();
      const spinner = document.getElementById('spinner');
      const processingText = document.getElementById('processingText');
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = '';
      if (!email) {
        statusDiv.textContent = 'theonlysocialpanel@gmail.com.';
        return;
      }
      if (isNaN(amount) || amount <= 0) {
        statusDiv.textContent = 'Please enter a valid deposit amount.';
        return;
      }
      spinner.style.display = 'block';
      processingText.style.display = 'block';
      setTimeout(() => {
        spinner.style.display = 'none';
        processingText.style.display = 'none';
        payWithFlutterwave(amount, email);
      }, 1200);
    }

    function payWithFlutterwave(amount, email) {
      FlutterwaveCheckout({
        public_key: 'FLWPUBK_TEST-9c02871359faf715e7455097eabf480b-X',
        tx_ref: 'tx-' + Date.now(),
        amount: amount,
        currency: 'NGN',
        payment_options: 'card,banktransfer,ussd',
        customer: { email },
        callback: function(response) {
          // Send transaction_id and amount to backend for verification
          fetch('/api/deposit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              email: email,
              transaction_id: response.transaction_id,
              amount: amount
            })
          })
          .then(res => res.json())
          .then(data => {
            if (data.success) {
              document.getElementById('status').textContent = 'Deposit successful! New balance: â‚¦' + data.balance;
              setTimeout(() => { window.location.href = 'dashboard.html'; }, 1500);
            } else {
              document.getElementById('status').textContent = 'Deposit failed: ' + data.message;
            }
          });
        },
        onclose: function() {
          document.getElementById('status').textContent = 'Payment was cancelled.';
        }
      });
    }
    </script>
</body>
</html>
